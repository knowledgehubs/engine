# Ø§Ø³Ù… Ø§Ù„Ù€ Workflow (ÙŠØ¸Ù‡Ø± ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Actions)
name: Deploy Hugo Site to Pages

# Ù…ØªÙ‰ ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù€ WorkflowØŸ
on:
  push:
    branches:
      - main  # ğŸ‘ˆ Ø¹Ù†Ø¯ Ø±ÙØ¹ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ

  # ÙŠØ³Ù…Ø­ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Workflow ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† ØªØ¨ÙˆÙŠØ¨ Actions
  workflow_dispatch:

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª (Permissions)
permissions:
  contents: read
  pages: write
  id-token: write

# ØªØ­Ø¯ÙŠØ¯ Ø¨ÙŠØ¦Ø© Ø§Ù„Ù†Ø´Ø± (ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ GitHub Pages)
environment:
  name: github-pages
  url: ${{ steps.deployment.outputs.page_url }}

jobs:
  # Ù…Ù‡Ù…Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true  # ÙÙŠ Ø­Ø§Ù„ Ø§Ø³ØªØ®Ø¯Ù…Øª Ù‚ÙˆØ§Ù„Ø¨ ÙØ±Ø¹ÙŠØ©
          fetch-depth: 0    # Ù…Ø·Ù„ÙˆØ¨ Ù„Ø£Ø¯ÙˆØ§Øª Git

      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v5

      - name: Setup Hugo (Extended)
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest' # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø­Ø¯Ø« Ø¥ØµØ¯Ø§Ø±
          extended: true         # âš ï¸ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† true Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ù€ SCSS

      - name: Build Hugo site
        run: |
          # Ø£Ù…Ø± Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø§Ø³ØªØ®Ø¯Ø§Ù… baseURL Ù…Ù† Ø§Ù„Ù€ Workflow)
          hugo \
            --minify \
            --baseURL "${{ steps.pages.outputs.base_url }}" \
            --destination public

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public

  # Ù…Ù‡Ù…Ø© Ø§Ù„Ù†Ø´Ø±
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
