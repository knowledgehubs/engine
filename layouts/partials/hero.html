{{/* layouts/partials/hero.html - High Conversion Block (Ultra-Defensive Version) */}}
{{ $ctx := .ctx }}
{{ $hero := .data }}
{{ $skin := .skin }}
{{ $meta := .meta }}

{{ $heading := default "Welcome" $hero.heading }}
{{ $sub := default "" $hero.subheading }}
{{ $cta_text := default "Contact Us" $hero.cta_text }}
{{ $cta_link := default "#" $hero.cta_link }}
{{ $bg := default "hero-bg.jpg" $hero.background }}
{{ $alt := default (printf "%s hero image" $meta.brand) $hero.alt }}

<section aria-labelledby="hero-heading" style="background:#f9f9f9; padding:4rem 0;">
  <div class="container" style="display:grid; grid-template-columns:1fr; gap:2rem; align-items:center;">
    <div style="position:relative;">
      <h1 id="hero-heading" style="font-size:2.5rem;">{{ $heading }}</h1>
      {{ if $sub }}<p style="font-size:1.2rem; color:#555;">{{ $sub }}</p>{{ end }}

      <div style="margin-top:2rem; display:flex; gap:1rem;">
        <a class="btn" href="{{ $cta_link }}">{{ $cta_text }}</a>
        {{ with $hero.phone }}
          {{ if ne . "" }}
            <a class="btn" href="tel:{{ . }}" style="background:transparent; color:var(--brand); border:1px solid var(--brand);">Call Us</a>
          {{ end }}
        {{ end }}
      </div>
    </div>

    {{/* كود معالجة الصورة الآمن (نقطة الانهيار السابقة) */}}
    {{ $assetPath := printf "images/%s/%s" $skin $bg }}
    {{ $img := resources.Get $assetPath }}

    {{/* نستخدم "with" لضمان عدم حدوث خطأ إذا لم يجد Hugo الملف. */}}
    {{ with $img }}
      {{/* محاولة المعالجة: إذا فشلت، سيظل $resized فارغاً */}}
      {{ $resized := .Fit "800x600 webp" | images.Quality 85 | default . }} 
      <div aria-hidden="true">
        {{/* نستخدم "with" مرة أخرى للعرض لضمان أن $resized ليس فارغاً */}}
        {{ with $resized }}
            <img src="{{ .RelPermalink }}" alt="{{ $alt }}" style="width:100%; border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,.15);" loading="eager">
        {{ end }}
      </div>
    {{ else }}
        {{ end }}
  </div>
</section>
