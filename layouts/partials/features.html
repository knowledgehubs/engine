{{/* layouts/partials/features.html - Ultra-Defensive Version (Loop Protected) */}}
{{ $features := .data }}
{{ $skin := .skin }}

{{ if and (isset $features "items") (gt (len $features.items) 0) }}
<section class="container" aria-labelledby="features-heading" style="padding:4rem 0;">
  {{ with $features.title }}<h2 id="features-heading" style="text-align:center;">{{ . }}</h2>{{ end }}
  {{ with $features.excerpt }}<p style="text-align:center; color:#777;">{{ . }}</p>{{ end }}

  <div class="grid" role="list" style="margin-top:2rem;">
    {{ range $i, $it := $features.items }}
      <article role="listitem" style="background:#fff;padding:1.5rem;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.04); text-align:center;">
        
        {{/* ğŸš¨ Ø§Ù„ØªØ­ØµÙŠÙ† Ù‡Ù†Ø§: Ù†Ø³ØªØ®Ø¯Ù… $img Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© */}}
        {{ $imgExists := false }}
        {{ $assetPath := "" }}
        {{ $thumb := "" }}

        {{ with $it.image }}
          {{ $assetPath = printf "images/%s/%s" $skin . }}
          {{ $resource := resources.Get $assetPath }}
          
          {{ if $resource }}
            {{ $imgExists = true }}
            {{ $thumb = $resource.Fit "300x200 webp" | images.Quality 80 }}
          {{ end }}
        {{ end }}
        
        {{/* ÙÙ‚Ø· Ø¥Ø°Ø§ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø¹Ø±Ø¶Ù‡Ø§ */}}
        {{ if $imgExists }}
            <img src="{{ $thumb.RelPermalink }}" alt="{{ $it.title | default "feature image" }}" style="width:100%;height:180px;object-fit:cover;border-radius:8px;margin-bottom:1rem;" loading="lazy">
        {{ else }}
            <div style="width:100%;height:180px;background:#f0f0f0;border-radius:8px;margin-bottom:1rem;display:flex;align-items:center;justify-content:center;color:#aaa;font-size:0.9rem;">Image Missing ({{ $it.title | default "Feature" }})</div>
        {{ end }}

        {{ with $it.title }}<h3 style="font-size:1.1rem; margin-bottom:0.5rem;">{{ . }}</h3>{{ end }}
        {{ with $it.desc }}<p style="font-size:0.95rem; color:#777;">{{ . }}</p>{{ end }}
      </article>
    {{ end }}
  </div>
</section>
{{ end }}
